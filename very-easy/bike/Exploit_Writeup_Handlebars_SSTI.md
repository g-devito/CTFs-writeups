---
title: "Exploit Write-up — Handlebars SSTI (Starting Point - HTB)"
author: Giovanni Chacon De Vito
date: 2025-10-12
tags: [easy, ssti, linux]
---

# Exploit Write-up — Handlebars SSTI (Starting Point)

> **Summary:** Exploited a Handlebars server-side template injection (SSTI) using `process.mainModule.require` to spawn a reverse shell, escalate to root, and capture the flag.  
> **Difficulty:** Very Easy   
> **Skills:** SSTI, template-engine fingerprinting, payload crafting, proxy-based delivery  
> **HTB:** https://app.hackthebox.com/starting-point

---

## Table of contents
1. [Reconnaissance](#reconnaissance)
2. [Resource development](#resource-development)
3. [Initial access](#initial-access)
4. [Privilege escalation](#privilege-escalation)
5. [Findings & recommendations](#findings--recommendations)
6. [Evidence & appendix](#evidence--appendix)

---

## Reconnaissance

### Port scan
- Performed an `nmap` scan and enumerated open services. See `evidences/nmap.txt`.  
- Command used (saved to `nmap.txt`):
```bash
nmap -sV -sS 10.129.84.44 -oN nmap.txt
```
- Results (high-level):
  - `80/tcp` — HTTP (tcpwrapped)
  - `22/tcp` — SSH

### Template testing & fingerprinting
- Performed simple template tests (e.g. `{{7*7}}`) and observed rendered output.  
- Determined template engine: **Handlebars**.  
- ![SSTI](`evidences/server-side_template_injection_output.png`)

---

## Resource development

### References and initial exploit idea
- Referenced existing writeups/exploits (HackTricks — SSTI / Handlebars).  
  - Link: https://book.hacktricks.wiki/en/pentesting-web/ssti-server-side-template-injection/index.html#handlebars

### Payload engineering
- Initial payload from HackTricks failed because `require` was not available in the expected scope.  
- Adjusted approach to use `process.mainModule.require`: ![burpsuite fixed payload](`.evidences/fixed_burpsuite_payload.png`)

### Listener
- Started a netcat listener to receive the reverse shell:
```bash
nc -lvnp 9000
```

---

## Initial access
- Delivered the payload via Burp Suite: ![burpsuite delivery]('.evidences/burpsuite_payload.png')
- Obtained an interactive shell on the target as root: ![root shell]('.evidences/root_access.png')  
- Retrieved flag: ![root flag]('.evidences/flag.png')

---

## Privilege escalation
> *Section intentionally left concise — see `Findings & recommendations` for mitigation and next steps.*

---

## Findings & recommendations

### Key findings
- The web application was vulnerable to Handlebars SSTI.
- The application environment allowed access patterns enabling remote code execution via template injection.

### Immediate remediation (high-level)
1. **Sanitize/validate** all user-controllable template inputs; avoid directly rendering user-supplied strings as templates.  
2. **Use a safe templating mode** or a sandboxed rendering environment when possible.  
3. **Harden Node.js process permissions** and follow principle of least privilege for app user accounts.  
4. **Update dependencies** and apply platform security best-practices (CSP, input validation, dependency scanning).  
5. **Audit logs** to detect exploitation attempts, and rotate secrets/keys if there was suspected exposure.

---

## Evidence & appendix

### Evidence
- `evidences/nmap.txt` — port/service enumeration
- `evidences/server-side_template_injection_output.png` — template test output
- `evidences/burpsuite_payload.png` — original payload screenshot
- `evidences/fixed_burpsuite_payload.png` — modified payload screenshot
- `evidences/root_access.png` — shell / privilege evidence
- `evidences/flag.png` — flag screenshot

### Appendix
- Notes, commands, and logs are retained in the `evidences/` folder. Keep original timestamps to aid triage.

---

## Conclusion
This test confirmed a critical server-side template injection in a Handlebars-based endpoint that permitted code execution. Immediate mitigation and deeper code-review are recommended to prevent similar exploitation in production systems.
